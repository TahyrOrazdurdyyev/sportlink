# Push Notifications - Admin Panel

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Frontend (Admin Panel)
- ‚úÖ **NotificationsPage** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **–ü–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** (TK, RU, EN)
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å/–±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
  - –í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  - –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–ø–æ FCM —Ç–æ–∫–µ–Ω—É)
- ‚úÖ **–ú–µ–Ω—é** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ "Notifications" –≤ –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é
- ‚úÖ **–†–æ—É—Ç–∏–Ω–≥** - `/notifications`

### Backend (Django)
- ‚úÖ **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
  - `POST /api/v1/admin/notifications/send/` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - `GET /api/v1/admin/notifications/stats/` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ **–¢–∏–ø—ã –æ—Ç–ø—Ä–∞–≤–∫–∏**:
  - `all` - –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  - `test` - —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  - `specific` - –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–≥–æ—Ç–æ–≤–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ)
- ‚úÖ **Batch –æ—Ç–ø—Ä–∞–≤–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ 500 —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** - —Ç–æ–ª—å–∫–æ –¥–ª—è `is_staff` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

**Backend:**
```bash
cd backend
python3.11 manage.py runserver
```

**Admin Panel:**
```bash
cd admin
npm run dev
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ –∞–¥–º–∏–Ω–∫–∏

1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Notifications"** (Habarlar / –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
   - **–í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** - –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å FCM —Ç–æ–∫–µ–Ω–∞–º–∏
   - **–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω—É–∂–µ–Ω FCM token)
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–ó–∞–≥–æ–ª–æ–≤–æ–∫** (Title)
   - **–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (Message Body)
   - **FCM Token** (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
5. –ù–∞–∂–º–∏—Ç–µ **"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"**

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ FCM —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∞

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –ª–æ–≥–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

```dart
// –°–º–æ—Ç—Ä–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö Flutter
FCM Token: dJxT9vQRSX2...
```

–ò–ª–∏ —á–µ—Ä–µ–∑ API –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```bash
GET /api/v1/users/me/
# –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç fcm_token
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Notifications –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

- **Total Users** - –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Users with tokens** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å FCM —Ç–æ–∫–µ–Ω–∞–º–∏ (–º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- **Users without tokens** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`IsAuthenticated`)
- ‚úÖ –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (`is_staff`)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ API
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üåç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

–í—Å–µ —Ç–µ–∫—Å—Ç—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ 3 —è–∑—ã–∫–∞:

| Turkmen | Russian | English |
|---------|---------|---------|
| Habarlar | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | Notifications |
| Ugratmak | –û—Ç–ø—Ä–∞–≤–∏—Ç—å | Send |
| Habary≈à Ady | –ó–∞–≥–æ–ª–æ–≤–æ–∫ | Title |
| Habary≈à Teksti | –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | Message Body |

---

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å FCM —Ç–æ–∫–µ–Ω–∞–º–∏
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É ‚Üí Notifications
3. –í—ã–±–µ—Ä–∏—Ç–µ "–í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"
4. –í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç
5. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "Sent to: X"

### –¢–µ—Å—Ç 2: –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
1. –ü–æ–ª—É—á–∏—Ç–µ FCM —Ç–æ–∫–µ–Ω –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É ‚Üí Notifications
3. –í—ã–±–µ—Ä–∏—Ç–µ "–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
4. –í—Å—Ç–∞–≤—å—Ç–µ FCM —Ç–æ–∫–µ–Ω
5. –í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç
6. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

---

## üîß API –ü—Ä–∏–º–µ—Ä—ã

### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
```bash
curl -X POST http://localhost:8000/api/v1/admin/notifications/send/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "–í–∞–∂–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ",
    "body": "–ù–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–≤—Ç—Ä–∞!",
    "type": "all"
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "sent_count": 150,
  "failed_count": 5,
  "total_users": 155,
  "message": "Broadcast sent to 150 users"
}
```

### –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```bash
curl -X POST http://localhost:8000/api/v1/admin/notifications/send/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Test",
    "body": "This is a test notification",
    "type": "test",
    "test_token": "dJxT9vQRSX2..."
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Test notification sent",
  "sent_count": 1
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```bash
curl http://localhost:8000/api/v1/admin/notifications/stats/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_users": 250,
  "users_with_tokens": 180,
  "users_without_tokens": 70
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **iOS**: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ iOS —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ APNs (–Ω—É–∂–µ–Ω Apple Developer Account)
2. **Android**: –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase
3. **–õ–∏–º–∏—Ç—ã**: FCM –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ 500 —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è)
4. **–¢–æ–∫–µ–Ω—ã**: FCM —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –Ω–∞ backend
5. **–ü—Ä–∞–≤–∞**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (is_staff=True) –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üìÇ –§–∞–π–ª—ã

### Frontend
- `admin/src/pages/NotificationsPage.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `admin/src/i18n/config.ts` - –ø–µ—Ä–µ–≤–æ–¥—ã
- `admin/src/components/Layout.tsx` - –º–µ–Ω—é
- `admin/src/App.tsx` - —Ä–æ—É—Ç–∏–Ω–≥

### Backend
- `backend/apps/notifications/views_admin.py` - API views
- `backend/apps/notifications/urls.py` - URL routing
- `backend/apps/notifications/fcm_utils.py` - —É—Ç–∏–ª–∏—Ç—ã FCM
- `backend/apps/notifications/tasks.py` - Celery –∑–∞–¥–∞—á–∏

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–°—Ç—Ä–∞–Ω–∏—Ü–∞ **Notifications** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ

